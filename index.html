<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BIST Pro v3.0 ‚Äî Borsa Analiz Platformu</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js" defer></script>
<style>
:root {
  --bg-primary: #0a0e17;
  --bg-secondary: #111827;
  --bg-card: #1a2234;
  --bg-card-hover: #1f2a40;
  --bg-input: #0d1321;
  --border: #2a3548;
  --border-hover: #3d4f6a;
  --text-primary: #e8ecf4;
  --text-secondary: #8896aa;
  --text-muted: #5a6a80;
  --accent: #00d4aa;
  --accent-dim: rgba(0,212,170,0.12);
  --accent-glow: rgba(0,212,170,0.25);
  --green: #00e5a0;
  --green-bg: rgba(0,229,160,0.1);
  --red: #ff4d6a;
  --red-bg: rgba(255,77,106,0.1);
  --yellow: #ffc547;
  --yellow-bg: rgba(255,197,71,0.1);
  --blue: #4da6ff;
  --blue-bg: rgba(77,166,255,0.1);
  --purple: #a78bfa;
  --font-body: 'Plus Jakarta Sans', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --radius: 12px;
  --radius-sm: 8px;
  --shadow: 0 4px 24px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 40px rgba(0,0,0,0.5);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: var(--font-body);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--border-hover); }

/* ‚îÄ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ‚îÄ */
.navbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 24px; height: 56px;
  background: rgba(10,14,23,0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}
.navbar-brand {
  display: flex; align-items: center; gap: 10px;
  font-weight: 800; font-size: 18px; color: var(--accent);
  cursor: pointer; text-decoration: none;
}
.navbar-brand span { color: var(--text-muted); font-weight: 500; font-size: 12px; }
.nav-links { display: flex; gap: 4px; }
.nav-link {
  padding: 8px 16px; border-radius: var(--radius-sm);
  color: var(--text-secondary); font-size: 13px; font-weight: 600;
  cursor: pointer; transition: all .2s; border: none; background: none;
  text-decoration: none;
}
.nav-link:hover { color: var(--text-primary); background: var(--bg-card); }
.nav-link.active { color: var(--accent); background: var(--accent-dim); }

.nav-search {
  display: flex; align-items: center; gap: 8px;
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 6px 12px;
}
.nav-search input {
  background: none; border: none; color: var(--text-primary);
  font-size: 13px; width: 180px; outline: none;
  font-family: var(--font-body);
}
.nav-search input::placeholder { color: var(--text-muted); }
.search-results-dropdown {
  position: absolute; top: 48px; right: 24px;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); min-width: 280px;
  box-shadow: var(--shadow-lg); display: none; max-height: 300px; overflow-y: auto;
}
.search-results-dropdown.show { display: block; }
.search-result-item {
  padding: 10px 14px; cursor: pointer; transition: background .15s;
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid var(--border);
}
.search-result-item:hover { background: var(--bg-card-hover); }
.search-result-item:last-child { border: none; }
.search-result-code { font-family: var(--font-mono); font-weight: 700; color: var(--accent); }
.search-result-name { color: var(--text-secondary); font-size: 12px; }

/* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */
.main { padding-top: 56px; min-height: 100vh; }
.page { display: none; padding: 24px; max-width: 1440px; margin: 0 auto; }
.page.active { display: block; }

/* ‚îÄ‚îÄ‚îÄ COMMON ‚îÄ‚îÄ‚îÄ */
.section-title {
  font-size: 20px; font-weight: 800; margin-bottom: 16px;
  display: flex; align-items: center; gap: 10px;
}
.section-title .icon { font-size: 22px; }

.card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px;
  transition: all .25s;
}
.card:hover { border-color: var(--border-hover); box-shadow: var(--shadow); }

.grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
.grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
.grid-5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; }

@media (max-width: 1024px) {
  .grid-4, .grid-5 { grid-template-columns: repeat(2, 1fr); }
  .grid-3 { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 640px) {
  .grid-2, .grid-3, .grid-4, .grid-5 { grid-template-columns: 1fr; }
  .navbar { padding: 0 12px; }
  .nav-links { display: none; }
  .page { padding: 16px; }
}

.badge {
  display: inline-flex; padding: 3px 8px; border-radius: 6px;
  font-size: 11px; font-weight: 700; font-family: var(--font-mono);
}
.badge-green { background: var(--green-bg); color: var(--green); }
.badge-red { background: var(--red-bg); color: var(--red); }
.badge-yellow { background: var(--yellow-bg); color: var(--yellow); }
.badge-blue { background: var(--blue-bg); color: var(--blue); }
.badge-neutral { background: rgba(136,150,170,0.1); color: var(--text-secondary); }

.price-up { color: var(--green); }
.price-down { color: var(--red); }

.btn {
  padding: 10px 20px; border-radius: var(--radius-sm); font-size: 13px;
  font-weight: 600; cursor: pointer; transition: all .2s;
  border: 1px solid var(--border); font-family: var(--font-body);
}
.btn-primary {
  background: var(--accent); color: var(--bg-primary); border: none;
}
.btn-primary:hover { filter: brightness(1.15); transform: translateY(-1px); }
.btn-secondary { background: var(--bg-card); color: var(--text-primary); }
.btn-secondary:hover { background: var(--bg-card-hover); }
.btn-sm { padding: 6px 12px; font-size: 12px; }

input, select {
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 10px 14px;
  color: var(--text-primary); font-size: 13px;
  font-family: var(--font-body); outline: none;
  transition: border .2s;
}
input:focus, select:focus { border-color: var(--accent); }

.loading {
  display: flex; align-items: center; justify-content: center;
  padding: 60px; color: var(--text-muted);
}
.spinner {
  width: 32px; height: 32px; border: 3px solid var(--border);
  border-top-color: var(--accent); border-radius: 50%;
  animation: spin .8s linear infinite; margin-right: 12px;
}
@keyframes spin { to { transform: rotate(360deg); } }

.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
th {
  text-align: left; padding: 10px 14px; font-size: 11px;
  text-transform: uppercase; letter-spacing: 0.5px;
  color: var(--text-muted); border-bottom: 1px solid var(--border);
  font-weight: 600; white-space: nowrap;
}
td {
  padding: 12px 14px; border-bottom: 1px solid rgba(42,53,72,0.5);
  font-size: 13px; white-space: nowrap;
}
tr:hover td { background: rgba(26,34,52,0.5); }
.td-mono { font-family: var(--font-mono); font-weight: 600; }
.td-clickable { cursor: pointer; color: var(--accent); }
.td-clickable:hover { text-decoration: underline; }

.empty-state {
  text-align: center; padding: 60px 20px; color: var(--text-muted);
}
.empty-state .icon { font-size: 48px; margin-bottom: 12px; }

.tabs { display: flex; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; }
.tab {
  padding: 8px 16px; border-radius: var(--radius-sm);
  font-size: 13px; font-weight: 600; cursor: pointer;
  color: var(--text-secondary); background: none; border: none;
  transition: all .2s; font-family: var(--font-body);
}
.tab:hover { color: var(--text-primary); background: var(--bg-card); }
.tab.active { color: var(--accent); background: var(--accent-dim); }

.flex-between { display: flex; justify-content: space-between; align-items: center; }
.flex-center { display: flex; align-items: center; }
.gap-8 { gap: 8px; }
.gap-12 { gap: 12px; }
.gap-16 { gap: 16px; }
.gap-24 { gap: 24px; }
.mb-8 { margin-bottom: 8px; }
.mb-16 { margin-bottom: 16px; }
.mb-24 { margin-bottom: 24px; }
.mt-16 { margin-top: 16px; }
.mt-24 { margin-top: 24px; }

/* ‚îÄ‚îÄ‚îÄ INDEX CARDS ‚îÄ‚îÄ‚îÄ */
.index-card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 16px 20px;
  transition: all .25s;
}
.index-card:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
.index-card .label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
.index-card .value { font-family: var(--font-mono); font-size: 22px; font-weight: 700; }
.index-card .change { font-family: var(--font-mono); font-size: 13px; font-weight: 600; margin-top: 4px; }

/* ‚îÄ‚îÄ‚îÄ STOCK TABLE ROW ‚îÄ‚îÄ‚îÄ */
.stock-row { cursor: pointer; }
.stock-row:hover td { background: var(--bg-card-hover); }

/* ‚îÄ‚îÄ‚îÄ STOCK DETAIL HEADER ‚îÄ‚îÄ‚îÄ */
.stock-header {
  display: flex; align-items: flex-start; justify-content: space-between;
  flex-wrap: wrap; gap: 20px; margin-bottom: 24px;
}
.stock-header .stock-price-big {
  font-family: var(--font-mono); font-size: 36px; font-weight: 700;
}
.stock-header .stock-change-big {
  font-family: var(--font-mono); font-size: 16px; font-weight: 600;
}
.stock-header .stock-name { font-size: 14px; color: var(--text-secondary); }

/* ‚îÄ‚îÄ‚îÄ INDICATOR PILL ‚îÄ‚îÄ‚îÄ */
.indicator-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
.indicator-card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 14px;
}
.indicator-card .ind-name { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
.indicator-card .ind-value { font-family: var(--font-mono); font-size: 18px; font-weight: 700; }
.indicator-card .ind-explanation { font-size: 11px; color: var(--text-secondary); margin-top: 4px; }

/* ‚îÄ‚îÄ‚îÄ FIBONACCI LEVELS ‚îÄ‚îÄ‚îÄ */
.fib-bar {
  display: flex; align-items: center; gap: 12px;
  padding: 8px 0; border-bottom: 1px solid rgba(42,53,72,0.3);
}
.fib-label { font-family: var(--font-mono); font-size: 12px; color: var(--text-muted); width: 50px; }
.fib-value { font-family: var(--font-mono); font-size: 13px; font-weight: 600; }
.fib-line { flex: 1; height: 2px; background: var(--border); position: relative; }
.fib-marker {
  position: absolute; top: -4px; width: 10px; height: 10px;
  background: var(--accent); border-radius: 50%;
}

/* ‚îÄ‚îÄ‚îÄ SCREENER CONDITION ‚îÄ‚îÄ‚îÄ */
.condition-row {
  display: flex; gap: 8px; align-items: center; margin-bottom: 8px; flex-wrap: wrap;
}
.condition-row select, .condition-row input { max-width: 180px; }
.remove-condition {
  background: var(--red-bg); color: var(--red); border: none;
  width: 28px; height: 28px; border-radius: 6px; cursor: pointer;
  font-size: 16px; display: flex; align-items: center; justify-content: center;
}

/* ‚îÄ‚îÄ‚îÄ BACKTEST RESULT ‚îÄ‚îÄ‚îÄ */
.bt-metric {
  text-align: center; padding: 16px;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius-sm);
}
.bt-metric .bt-val { font-family: var(--font-mono); font-size: 20px; font-weight: 700; }
.bt-metric .bt-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

/* ‚îÄ‚îÄ‚îÄ BREADTH BAR ‚îÄ‚îÄ‚îÄ */
.breadth-bar {
  display: flex; height: 28px; border-radius: 14px; overflow: hidden;
  background: var(--bg-input); margin: 8px 0;
}
.breadth-bar .adv { background: var(--green); transition: width .5s; }
.breadth-bar .unc { background: var(--yellow); transition: width .5s; }
.breadth-bar .dec { background: var(--red); transition: width .5s; }

/* ‚îÄ‚îÄ‚îÄ CHART CONTAINER ‚îÄ‚îÄ‚îÄ */
.chart-container {
  position: relative; width: 100%; background: var(--bg-card);
  border: 1px solid var(--border); border-radius: var(--radius);
  padding: 16px;
}
.chart-container canvas { max-height: 400px; }

/* Mobile nav toggle */
.nav-toggle {
  display: none; background: none; border: none; color: var(--text-primary);
  font-size: 24px; cursor: pointer;
}
@media (max-width: 640px) {
  .nav-toggle { display: block; }
  .nav-links.show { display: flex; position: absolute; top: 56px; left: 0; right: 0;
    background: var(--bg-secondary); flex-direction: column; padding: 12px;
    border-bottom: 1px solid var(--border); }
}

/* ‚îÄ‚îÄ‚îÄ FADE IN ‚îÄ‚îÄ‚îÄ */
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
.fade-in { animation: fadeIn .4s ease-out; }

/* ‚îÄ‚îÄ‚îÄ PORTFOLIO TABLE ‚îÄ‚îÄ‚îÄ */
.pnl-positive { color: var(--green); }
.pnl-negative { color: var(--red); }
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <a class="navbar-brand" onclick="navigate('dashboard')">
    ‚óÜ BIST Pro <span>v3.0</span>
  </a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('show')">‚ò∞</button>
  <div class="nav-links">
    <button class="nav-link active" data-page="dashboard" onclick="navigate('dashboard')">Dashboard</button>
    <button class="nav-link" data-page="bist100" onclick="navigate('bist100')">BIST 100</button>
    <button class="nav-link" data-page="screener" onclick="navigate('screener')">Tarayƒ±cƒ±</button>
    <button class="nav-link" data-page="portfolio" onclick="navigate('portfolio')">Portf√∂y</button>
    <button class="nav-link" data-page="backtest" onclick="navigate('backtest')">Backtest</button>
    <button class="nav-link" data-page="alerts" onclick="navigate('alerts')">Uyarƒ±lar</button>
  </div>
  <div style="position:relative;">
    <div class="nav-search">
      <span style="color:var(--text-muted)">üîç</span>
      <input type="text" id="globalSearch" placeholder="Hisse ara... (THYAO)" oninput="onSearch(this.value)" onfocus="onSearch(this.value)">
    </div>
    <div class="search-results-dropdown" id="searchDropdown"></div>
  </div>
</nav>

<!-- MAIN -->
<div class="main">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-dashboard">
  <div class="section-title mb-24"><span class="icon">üìä</span> Piyasa √ñzeti</div>

  <!-- Endeks Kartlarƒ± -->
  <div class="grid-5 mb-24" id="indicesCards">
    <div class="index-card"><div class="label">Y√ºkleniyor...</div><div class="spinner" style="margin:8px auto;width:20px;height:20px;border-width:2px;"></div></div>
  </div>

  <!-- Piyasa Geni≈üliƒüi -->
  <div class="card mb-24" id="breadthCard">
    <div class="flex-between mb-8">
      <div style="font-weight:700;font-size:14px;">Piyasa Geni≈üliƒüi</div>
      <div id="breadthStats" style="font-size:12px;color:var(--text-secondary);"></div>
    </div>
    <div class="breadth-bar">
      <div class="adv" id="breadthAdv" style="width:50%"></div>
      <div class="unc" id="breadthUnc" style="width:10%"></div>
      <div class="dec" id="breadthDec" style="width:40%"></div>
    </div>
    <div class="flex-between" style="font-size:11px;color:var(--text-muted);margin-top:4px;">
      <span>üü¢ Y√ºkselen: <span id="advCount">-</span></span>
      <span>üü° Deƒüi≈ümez: <span id="uncCount">-</span></span>
      <span>üî¥ D√º≈üen: <span id="decCount">-</span></span>
    </div>
  </div>

  <!-- Movers Grid -->
  <div class="grid-2 mb-24">
    <!-- En √áok Artan -->
    <div class="card">
      <div style="font-weight:700;font-size:14px;margin-bottom:12px;">üöÄ En √áok Artan</div>
      <div class="table-wrap"><table>
        <thead><tr><th>Hisse</th><th>Fiyat</th><th>Deƒüi≈üim</th></tr></thead>
        <tbody id="topGainers"></tbody>
      </table></div>
    </div>
    <!-- En √áok Azalan -->
    <div class="card">
      <div style="font-weight:700;font-size:14px;margin-bottom:12px;">üìâ En √áok Azalan</div>
      <div class="table-wrap"><table>
        <thead><tr><th>Hisse</th><th>Fiyat</th><th>Deƒüi≈üim</th></tr></thead>
        <tbody id="topLosers"></tbody>
      </table></div>
    </div>
  </div>

  <div class="grid-2 mb-24">
    <!-- Hacim Liderleri -->
    <div class="card">
      <div style="font-weight:700;font-size:14px;margin-bottom:12px;">üìä Hacim Liderleri</div>
      <div class="table-wrap"><table>
        <thead><tr><th>Hisse</th><th>Fiyat</th><th>Hacim</th></tr></thead>
        <tbody id="volumeLeaders"></tbody>
      </table></div>
    </div>
    <!-- Gap A√ßanlar -->
    <div class="card">
      <div style="font-weight:700;font-size:14px;margin-bottom:12px;">‚ö° Gap A√ßanlar</div>
      <div class="table-wrap"><table>
        <thead><tr><th>Hisse</th><th>Fiyat</th><th>Gap %</th></tr></thead>
        <tbody id="gapStocks"></tbody>
      </table></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BIST 100 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-bist100">
  <div class="flex-between mb-24">
    <div class="section-title"><span class="icon">üìã</span> BIST 100 Hisseleri</div>
    <div class="flex-center gap-8">
      <select id="sectorFilter" onchange="loadBist100()">
        <option value="">T√ºm Sekt√∂rler</option>
      </select>
      <select id="sortFilter" onchange="loadBist100()">
        <option value="code">Kod</option>
        <option value="change">Deƒüi≈üim</option>
        <option value="volume">Hacim</option>
        <option value="price">Fiyat</option>
      </select>
    </div>
  </div>
  <div class="card">
    <div class="table-wrap"><table>
      <thead><tr>
        <th>Kod</th><th>ƒ∞sim</th><th>Fiyat</th><th>Deƒüi≈üim</th><th>Deƒüi≈üim %</th><th>Hacim</th><th>A√ßƒ±lƒ±≈ü</th><th>Y√ºksek</th><th>D√º≈ü√ºk</th>
      </tr></thead>
      <tbody id="bist100Table"></tbody>
    </table></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STOCK DETAIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-stock">
  <div id="stockDetailContent">
    <div class="empty-state">
      <div class="icon">üìà</div>
      <div>Bir hisse se√ßin veya arama yapƒ±n</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREENER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-screener">
  <div class="section-title mb-24"><span class="icon">üîç</span> Hisse Tarayƒ±cƒ±</div>

  <div class="card mb-24">
    <div style="font-weight:700;margin-bottom:12px;">Ko≈üullar</div>
    <div id="screenerConditions">
      <div class="condition-row">
        <select class="sc-indicator">
          <option value="rsi">RSI</option>
          <option value="volume_ratio">Hacim Oranƒ±</option>
          <option value="atr_pct">ATR %</option>
          <option value="ema_cross">EMA Cross</option>
          <option value="breakout">Breakout</option>
          <option value="macd_signal">MACD Sinyal</option>
          <option value="price_above_ema20">Fiyat > EMA20</option>
          <option value="price_above_ema50">Fiyat > EMA50</option>
        </select>
        <select class="sc-operator">
          <option value="<">&lt;</option>
          <option value=">">&gt;</option>
          <option value="<=">&le;</option>
          <option value=">=">&ge;</option>
          <option value="==">=</option>
        </select>
        <input class="sc-value" placeholder="Deƒüer" style="width:100px;">
        <button class="remove-condition" onclick="this.parentElement.remove()">‚úï</button>
      </div>
    </div>
    <div class="flex-center gap-8 mt-16">
      <button class="btn btn-secondary btn-sm" onclick="addScreenerCondition()">+ Ko≈üul Ekle</button>
      <select id="screenerSector" style="font-size:13px;">
        <option value="">T√ºm Sekt√∂rler</option>
      </select>
      <button class="btn btn-primary" onclick="runScreener()">Tara üîç</button>
    </div>
  </div>

  <div class="card" id="screenerResults" style="display:none;">
    <div class="flex-between mb-16">
      <div style="font-weight:700;">Sonu√ßlar</div>
      <div id="screenerCount" style="font-size:12px;color:var(--text-secondary);"></div>
    </div>
    <div class="table-wrap"><table>
      <thead><tr><th>Kod</th><th>ƒ∞sim</th><th>Fiyat</th><th>Deƒüi≈üim %</th><th>RSI</th><th>Hacim Oran</th><th>EMA Cross</th></tr></thead>
      <tbody id="screenerTable"></tbody>
    </table></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PORTFOLIO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-portfolio">
  <div class="flex-between mb-24">
    <div class="section-title"><span class="icon">üíº</span> Portf√∂y</div>
    <button class="btn btn-primary btn-sm" onclick="showAddPositionForm()">+ Pozisyon Ekle</button>
  </div>

  <!-- Ekleme Formu -->
  <div class="card mb-24" id="addPositionForm" style="display:none;">
    <div style="font-weight:700;margin-bottom:12px;">Yeni Pozisyon</div>
    <div class="flex-center gap-8" style="flex-wrap:wrap;">
      <input id="pfSymbol" placeholder="Hisse Kodu (THYAO)" style="width:140px;">
      <input id="pfQty" type="number" placeholder="Adet" style="width:100px;">
      <input id="pfCost" type="number" step="0.01" placeholder="Ort. Maliyet" style="width:140px;">
      <button class="btn btn-primary btn-sm" onclick="addPosition()">Ekle</button>
      <button class="btn btn-secondary btn-sm" onclick="document.getElementById('addPositionForm').style.display='none'">ƒ∞ptal</button>
    </div>
  </div>

  <!-- Portf√∂y √ñzeti -->
  <div class="grid-4 mb-24" id="portfolioSummary"></div>

  <!-- Pozisyonlar -->
  <div class="card mb-24">
    <div style="font-weight:700;margin-bottom:12px;">Pozisyonlar</div>
    <div class="table-wrap"><table>
      <thead><tr><th>Hisse</th><th>Adet</th><th>Ort. Maliyet</th><th>G√ºncel</th><th>Piyasa Deƒüeri</th><th>Kar/Zarar</th><th>K/Z %</th><th>Aƒüƒ±rlƒ±k</th><th></th></tr></thead>
      <tbody id="portfolioTable"></tbody>
    </table></div>
  </div>

  <!-- Risk -->
  <div class="card" id="riskCard" style="display:none;">
    <div style="font-weight:700;margin-bottom:12px;">üìä Risk Analizi</div>
    <div class="grid-4" id="riskMetrics"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BACKTEST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-backtest">
  <div class="section-title mb-24"><span class="icon">üîÑ</span> Backtest</div>

  <div class="card mb-24">
    <div class="grid-3 gap-16" style="align-items:end;">
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Hisse</label>
        <input id="btSymbol" placeholder="THYAO" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Strateji</label>
        <select id="btStrategy" style="width:100%;" onchange="updateBtParams()">
          <option value="ma_cross">MA Cross</option>
          <option value="breakout">Breakout</option>
          <option value="mean_reversion">Mean Reversion (RSI)</option>
        </select>
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Periyot</label>
        <select id="btPeriod" style="width:100%;">
          <option value="1y">1 Yƒ±l</option>
          <option value="2y" selected>2 Yƒ±l</option>
          <option value="5y">5 Yƒ±l</option>
        </select>
      </div>
    </div>
    <div class="grid-4 gap-16 mt-16" id="btParamsRow">
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Hƒ±zlƒ± MA</label>
        <input id="btParam1" type="number" value="20" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Yava≈ü MA</label>
        <input id="btParam2" type="number" value="50" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Komisyon %</label>
        <input id="btCommission" type="number" value="0.1" step="0.01" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Ba≈ülangƒ±√ß ‚Ç∫</label>
        <input id="btCapital" type="number" value="100000" style="width:100%;">
      </div>
    </div>
    <div class="mt-16">
      <button class="btn btn-primary" onclick="runBacktest()">Backtest Ba≈ülat üöÄ</button>
    </div>
  </div>

  <div id="btResults" style="display:none;">
    <div class="grid-4 mb-24" id="btMetrics"></div>
    <div class="card mb-24">
      <div style="font-weight:700;margin-bottom:12px;">Equity Curve</div>
      <div class="chart-container"><canvas id="btChart"></canvas></div>
    </div>
    <div class="card">
      <div style="font-weight:700;margin-bottom:12px;">ƒ∞≈ülem Ge√ßmi≈üi</div>
      <div class="table-wrap"><table>
        <thead><tr><th>Tarih</th><th>ƒ∞≈ülem</th><th>Fiyat</th><th>Adet</th><th>K/Z</th></tr></thead>
        <tbody id="btTrades"></tbody>
      </table></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALERTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-alerts">
  <div class="flex-between mb-24">
    <div class="section-title"><span class="icon">üîî</span> Uyarƒ±lar</div>
    <button class="btn btn-primary btn-sm" onclick="document.getElementById('alertForm').style.display='block'">+ Uyarƒ± Ekle</button>
  </div>

  <div class="card mb-24" id="alertForm" style="display:none;">
    <div style="font-weight:700;margin-bottom:12px;">Yeni Uyarƒ±</div>
    <div class="grid-3 gap-16" style="align-items:end;">
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Hisse</label>
        <input id="alertSymbol" placeholder="THYAO" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Ko≈üul</label>
        <select id="alertCondition" style="width:100%;">
          <option value="price_above">Fiyat √úst√ºnde</option>
          <option value="price_below">Fiyat Altƒ±nda</option>
          <option value="rsi_above">RSI √úst√ºnde</option>
          <option value="rsi_below">RSI Altƒ±nda</option>
          <option value="volume_spike">Hacim Spike</option>
          <option value="breakout">Breakout</option>
          <option value="macd_cross_up">MACD Yukarƒ± Cross</option>
          <option value="macd_cross_down">MACD A≈üaƒüƒ± Cross</option>
        </select>
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">E≈üik Deƒüer</label>
        <input id="alertThreshold" type="number" step="0.01" placeholder="300" style="width:100%;">
      </div>
    </div>
    <div class="grid-3 gap-16 mt-16" style="align-items:end;">
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">E-posta</label>
        <input id="alertEmail" placeholder="email@example.com" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Cooldown (dk)</label>
        <input id="alertCooldown" type="number" value="60" style="width:100%;">
      </div>
      <div>
        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Teyit Bar</label>
        <input id="alertConfirm" type="number" value="2" style="width:100%;">
      </div>
    </div>
    <div class="flex-center gap-8 mt-16">
      <button class="btn btn-primary btn-sm" onclick="createAlert()">Olu≈ütur</button>
      <button class="btn btn-secondary btn-sm" onclick="document.getElementById('alertForm').style.display='none'">ƒ∞ptal</button>
    </div>
  </div>

  <div class="card">
    <div class="table-wrap"><table>
      <thead><tr><th>Hisse</th><th>Ko≈üul</th><th>E≈üik</th><th>Cooldown</th><th>Teyit</th><th>Tetikleme</th><th>Durum</th><th></th></tr></thead>
      <tbody id="alertsTable"></tbody>
    </table></div>
  </div>
</div>

</div><!-- /main -->

<script>
// =============================================================================
// CONFIG
// =============================================================================
const API_BASE = window.location.origin + '/api';
let currentChart = null;
let btChartInstance = null;

// =============================================================================
// NAVIGATION
// =============================================================================
function navigate(page, params) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));

  const el = document.getElementById('page-' + page);
  if (el) { el.classList.add('active'); el.classList.add('fade-in'); }

  const nav = document.querySelector(`.nav-link[data-page="${page}"]`);
  if (nav) nav.classList.add('active');

  // Close mobile nav
  document.querySelector('.nav-links').classList.remove('show');

  // Load data
  switch(page) {
    case 'dashboard': loadDashboard(); break;
    case 'bist100': loadBist100(); break;
    case 'stock': if(params?.symbol) loadStockDetail(params.symbol); break;
    case 'screener': loadSectors('screenerSector'); break;
    case 'portfolio': loadPortfolio(); break;
    case 'backtest': break;
    case 'alerts': loadAlerts(); break;
  }
}

function goToStock(symbol) {
  navigate('stock', { symbol });
}

// =============================================================================
// API HELPER
// =============================================================================
async function api(path, options = {}) {
  try {
    const res = await fetch(API_BASE + path, {
      headers: { 'Content-Type': 'application/json' },
      ...options,
    });
    const text = await res.text();
    try {
      return JSON.parse(text);
    } catch(parseErr) {
      console.error('API JSON parse error:', path, text.substring(0, 200));
      return { error: 'Sunucudan ge√ßersiz yanƒ±t geldi. L√ºtfen sayfayƒ± yenileyin.', status: res.status };
    }
  } catch(e) {
    console.error('API Error:', path, e);
    return { error: e.message };
  }
}

// =============================================================================
// FORMATTERS
// =============================================================================
function fmtPrice(v) { return v != null ? Number(v).toLocaleString('tr-TR', {minimumFractionDigits:2, maximumFractionDigits:2}) : '-'; }
function fmtPct(v) { return v != null ? (v >= 0 ? '+' : '') + Number(v).toFixed(2) + '%' : '-'; }
function fmtVolume(v) {
  if (!v) return '-';
  if (v >= 1e9) return (v/1e9).toFixed(1) + 'B';
  if (v >= 1e6) return (v/1e6).toFixed(1) + 'M';
  if (v >= 1e3) return (v/1e3).toFixed(0) + 'K';
  return v.toString();
}
function fmtMoney(v) { return '‚Ç∫' + fmtPrice(v); }
function changeClass(v) { return v >= 0 ? 'price-up' : 'price-down'; }
function signalBadge(s) {
  if (s === 'buy') return '<span class="badge badge-green">AL</span>';
  if (s === 'sell') return '<span class="badge badge-red">SAT</span>';
  return '<span class="badge badge-neutral">N√ñTR</span>';
}

// =============================================================================
// SEARCH
// =============================================================================
let searchTimeout;
function onSearch(q) {
  clearTimeout(searchTimeout);
  const dd = document.getElementById('searchDropdown');
  if (!q || q.length < 1) { dd.classList.remove('show'); return; }
  searchTimeout = setTimeout(async () => {
    const data = await api('/search?q=' + encodeURIComponent(q));
    if (data.results && data.results.length > 0) {
      dd.innerHTML = data.results.map(r =>
        `<div class="search-result-item" onclick="goToStock('${r.code}');document.getElementById('searchDropdown').classList.remove('show');document.getElementById('globalSearch').value='';">
          <span class="search-result-code">${r.code}</span>
          <span class="search-result-name">${r.name}</span>
        </div>`
      ).join('');
      dd.classList.add('show');
    } else {
      dd.innerHTML = '<div style="padding:12px;color:var(--text-muted);font-size:13px;">Sonu√ß bulunamadƒ±</div>';
      dd.classList.add('show');
    }
  }, 200);
}
document.addEventListener('click', e => {
  if (!e.target.closest('.nav-search')) document.getElementById('searchDropdown').classList.remove('show');
});

// =============================================================================
// DASHBOARD
// =============================================================================
async function loadDashboard() {
  // Indices
  loadIndices();
  // Dashboard data
  const data = await api('/dashboard');
  if (data.error && !data.success) {
    document.getElementById('indicesCards').innerHTML = `
      <div class="index-card" style="grid-column:1/-1;text-align:center;">
        <div style="color:var(--yellow);margin-bottom:8px;">‚ö†Ô∏è Veri y√ºklenirken sorun olu≈ütu</div>
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:12px;">${data.error}</div>
        <button class="btn btn-primary btn-sm" onclick="loadDashboard()">Tekrar Dene</button>
      </div>`;
    return;
  }

  if (data.loading || (data.allStocks && data.allStocks.length === 0)) {
    document.getElementById('indicesCards').innerHTML = `
      <div class="index-card" style="grid-column:1/-1;text-align:center;">
        <div class="spinner" style="margin:0 auto 12px;"></div>
        <div style="color:var(--yellow);margin-bottom:8px;">‚è≥ ${data.message || 'Veriler y√ºkleniyor...'}</div>
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Sunucu arka planda veri √ßekiyor, otomatik yenilenecek...</div>
        <button class="btn btn-primary btn-sm" onclick="loadDashboard()">≈ûimdi Yenile</button>
      </div>`;
    // Auto-retry 10sn sonra
    setTimeout(() => loadDashboard(), 10000);
    return;
  }

  // Breadth
  const mb = data.marketBreadth || {};
  const total = (mb.advancing||0) + (mb.declining||0) + (mb.unchanged||0) || 1;
  document.getElementById('breadthAdv').style.width = (mb.advancing/total*100) + '%';
  document.getElementById('breadthUnc').style.width = (mb.unchanged/total*100) + '%';
  document.getElementById('breadthDec').style.width = (mb.declining/total*100) + '%';
  document.getElementById('advCount').textContent = mb.advancing || 0;
  document.getElementById('uncCount').textContent = mb.unchanged || 0;
  document.getElementById('decCount').textContent = mb.declining || 0;
  document.getElementById('breadthStats').textContent = `A/D Oranƒ±: ${mb.advDecRatio || '-'}`;

  // Movers tables
  renderMoverTable('topGainers', data.movers?.topGainers, 'changePct');
  renderMoverTable('topLosers', data.movers?.topLosers, 'changePct');
  renderMoverTable('volumeLeaders', data.movers?.volumeLeaders, 'volume', true);
  renderMoverTable('gapStocks', data.movers?.gapStocks, 'gapPct');
}

async function loadIndices() {
  const data = await api('/indices');
  if (!data.success || !data.indices || Object.keys(data.indices).length === 0) {
    document.getElementById('indicesCards').innerHTML = `
      <div class="index-card" style="grid-column:1/-1;text-align:center;">
        <div class="spinner" style="margin:0 auto 8px;"></div>
        <div style="color:var(--text-muted);">Endeks verileri y√ºkleniyor... <button class="btn btn-sm btn-secondary" onclick="loadIndices()" style="margin-left:8px;">Yenile</button></div>
      </div>`;
    // Auto-retry
    setTimeout(() => loadIndices(), 8000);
    return;
  }

  const idx = data.indices;
  const cards = Object.entries(idx).map(([key, val]) => `
    <div class="index-card">
      <div class="label">${val.name}</div>
      <div class="value">${fmtPrice(val.value)}</div>
      <div class="change ${changeClass(val.changePct)}">
        ${val.change >= 0 ? '‚ñ≤' : '‚ñº'} ${fmtPrice(Math.abs(val.change))} (${fmtPct(val.changePct)})
      </div>
    </div>
  `).join('');
  document.getElementById('indicesCards').innerHTML = cards;
}

function renderMoverTable(id, stocks, metric, isVolume) {
  if (!stocks) return;
  document.getElementById(id).innerHTML = stocks.map(s => `
    <tr class="stock-row" onclick="goToStock('${s.code}')">
      <td><span class="td-clickable td-mono">${s.code}</span></td>
      <td class="td-mono">${fmtPrice(s.price)}</td>
      <td class="td-mono ${isVolume ? '' : changeClass(s[metric])}">
        ${isVolume ? fmtVolume(s[metric]) : fmtPct(s[metric])}
      </td>
    </tr>
  `).join('');
}

// =============================================================================
// BIST 100
// =============================================================================
async function loadBist100() {
  const sector = document.getElementById('sectorFilter').value;
  const sort = document.getElementById('sortFilter').value;
  const params = new URLSearchParams({ sort, order: 'desc' });
  if (sector) params.set('sector', sector);

  document.getElementById('bist100Table').innerHTML = '<tr><td colspan="9"><div class="loading"><div class="spinner"></div>Y√ºkleniyor...</div></td></tr>';

  const data = await api('/bist100?' + params.toString());
  if (!data.success) return;

  // Loading state - veriler hen√ºz hazƒ±r deƒüil
  if (data.loading || !data.stocks || data.stocks.length === 0) {
    document.getElementById('bist100Table').innerHTML = `<tr><td colspan="9"><div class="loading"><div class="spinner"></div>${data.message || 'Veriler y√ºkleniyor... Otomatik yenilenecek.'}</div></td></tr>`;
    setTimeout(() => loadBist100(), 10000);
    return;
  }

  // Sekt√∂r filtresi doldur
  if (data.sectors) {
    const sel = document.getElementById('sectorFilter');
    if (sel.options.length <= 1) {
      data.sectors.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s; opt.textContent = s.charAt(0).toUpperCase() + s.slice(1);
        sel.appendChild(opt);
      });
    }
  }

  document.getElementById('bist100Table').innerHTML = (data.stocks || []).map(s => `
    <tr class="stock-row" onclick="goToStock('${s.code}')">
      <td class="td-mono td-clickable">${s.code}</td>
      <td>${s.name}</td>
      <td class="td-mono">${fmtPrice(s.price)}</td>
      <td class="td-mono ${changeClass(s.change)}">${s.change >= 0 ? '+' : ''}${fmtPrice(s.change)}</td>
      <td class="td-mono ${changeClass(s.changePct)}">${fmtPct(s.changePct)}</td>
      <td class="td-mono">${fmtVolume(s.volume)}</td>
      <td class="td-mono">${fmtPrice(s.open)}</td>
      <td class="td-mono">${fmtPrice(s.high)}</td>
      <td class="td-mono">${fmtPrice(s.low)}</td>
    </tr>
  `).join('');
}

async function loadSectors(selectId) {
  const data = await api('/sectors');
  if (!data.success) return;
  const sel = document.getElementById(selectId);
  if (sel && sel.options.length <= 1) {
    (data.sectors||[]).forEach(s => {
      const opt = document.createElement('option');
      opt.value = s.name; opt.textContent = s.name.charAt(0).toUpperCase() + s.name.slice(1) + ` (${s.avgChange >= 0 ? '+' : ''}${s.avgChange}%)`;
      sel.appendChild(opt);
    });
  }
}

// =============================================================================
// STOCK DETAIL
// =============================================================================
async function loadStockDetail(symbol) {
  const container = document.getElementById('stockDetailContent');
  container.innerHTML = '<div class="loading"><div class="spinner"></div>Hisse verisi y√ºkleniyor...</div>';

  // Nav'ƒ± g√ºncelle
  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));

  const [stockData, eventsData] = await Promise.all([
    api('/stock/' + symbol + '?period=1y'),
    api('/stock/' + symbol + '/events')
  ]);

  if (stockData.error && !stockData.success) {
    container.innerHTML = `<div class="empty-state"><div class="icon">‚ùå</div><div>Hata: ${stockData.error}</div></div>`;
    return;
  }

  if (stockData.loading && (!stockData.indicators || Object.keys(stockData.indicators).length === 0)) {
    container.innerHTML = `<div class="empty-state"><div class="spinner" style="margin:0 auto 16px;"></div><div style="color:var(--yellow);">‚è≥ ${stockData.message || 'Veri y√ºkleniyor...'}</div><div style="font-size:12px;color:var(--text-muted);margin-top:8px;">ƒ∞lk y√ºkleme birka√ß saniye s√ºrebilir.</div><button class="btn btn-primary btn-sm" onclick="loadStockDetail('${symbol}')" style="margin-top:12px;">Yenile</button></div>`;
    setTimeout(() => loadStockDetail(symbol), 5000);
    return;
  }

  const s = stockData;
  const events = eventsData?.events || {};
  const ind = s.indicators || {};
  const summary = ind.summary || {};

  container.innerHTML = `
    <!-- Header -->
    <div class="stock-header fade-in">
      <div>
        <div class="stock-name">${s.name} ¬∑ ${s.code}</div>
        <div class="stock-price-big ${changeClass(s.changePercent)}">${fmtPrice(s.price)} ‚Ç∫</div>
        <div class="stock-change-big ${changeClass(s.changePercent)}">
          ${s.change >= 0 ? '‚ñ≤' : '‚ñº'} ${fmtPrice(Math.abs(s.change))} (${fmtPct(s.changePercent)})
        </div>
      </div>
      <div class="flex-center gap-8">
        ${['1mo','3mo','6mo','1y','2y','5y'].map(p =>
          `<button class="btn btn-sm ${p === s.period ? 'btn-primary' : 'btn-secondary'}" onclick="loadStockPeriod('${s.code}','${p}')">${p}</button>`
        ).join('')}
      </div>
    </div>

    <!-- Info Cards -->
    <div class="grid-4 mb-24 fade-in">
      <div class="card" style="text-align:center;">
        <div style="font-size:11px;color:var(--text-muted);">G√ºn Aralƒ±ƒüƒ±</div>
        <div class="td-mono" style="margin-top:4px;">${fmtPrice(s.dayLow)} - ${fmtPrice(s.dayHigh)}</div>
      </div>
      <div class="card" style="text-align:center;">
        <div style="font-size:11px;color:var(--text-muted);">Hacim</div>
        <div class="td-mono" style="margin-top:4px;">${fmtVolume(s.volume)}</div>
      </div>
      <div class="card" style="text-align:center;">
        <div style="font-size:11px;color:var(--text-muted);">52H Aralƒ±k</div>
        <div class="td-mono" style="margin-top:4px;">${s.week52Low ? fmtPrice(s.week52Low) + ' - ' + fmtPrice(s.week52High) : '-'}</div>
      </div>
      <div class="card" style="text-align:center;">
        <div style="font-size:11px;color:var(--text-muted);">Piyasa Deƒüeri</div>
        <div class="td-mono" style="margin-top:4px;">${s.marketCap ? fmtVolume(s.marketCap) : '-'}</div>
      </div>
    </div>

    <!-- Sinyal √ñzeti -->
    <div class="card mb-24 fade-in">
      <div class="flex-between mb-8">
        <div style="font-weight:700;">Teknik Sinyal √ñzeti</div>
        ${signalBadge(summary.overall)}
      </div>
      <div style="font-size:13px;color:var(--text-secondary);">${summary.explanation || ''}</div>
      <div class="flex-center gap-16 mt-16" style="font-size:13px;">
        <span class="price-up">üü¢ AL: ${summary.buySignals || 0}</span>
        <span class="price-down">üî¥ SAT: ${summary.sellSignals || 0}</span>
        <span style="color:var(--text-muted);">‚ö™ N√∂tr: ${summary.neutralSignals || 0}</span>
      </div>
    </div>

    <!-- Price Chart -->
    <div class="chart-container mb-24 fade-in">
      <canvas id="priceChart"></canvas>
    </div>

    <!-- Indicators Grid -->
    <div class="section-title mb-16">Teknik ƒ∞ndikat√∂rler</div>
    <div class="indicator-grid mb-24 fade-in">
      ${renderIndicator(ind.rsi)}
      ${renderIndicator(ind.macd, 'MACD', ind.macd?.macd)}
      ${renderIndicator(ind.bollinger, 'Bollinger', null)}
      ${renderIndicator(ind.ema)}
      ${renderIndicator(ind.stochastic, 'Stochastic', ind.stochastic?.k)}
      ${renderIndicator(ind.atr)}
      ${renderIndicator(ind.adx)}
      ${renderIndicator(ind.cci)}
      ${renderIndicator(ind.williamsr)}
      ${renderIndicator(ind.obv, 'OBV', ind.obv?.value)}
    </div>

    <!-- Fibonacci & S/R -->
    <div class="grid-2 mb-24">
      <div class="card fade-in">
        <div style="font-weight:700;margin-bottom:12px;">Fibonacci Seviyeleri</div>
        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:12px;">${s.fibonacci?.currentZone || ''}</div>
        ${renderFibonacci(s.fibonacci)}
      </div>
      <div class="card fade-in">
        <div style="font-weight:700;margin-bottom:12px;">Destek / Diren√ß</div>
        ${renderSR(s.supportResistance)}
      </div>
    </div>

    <!-- Fundamentals -->
    <div class="card mb-24 fade-in">
      <div style="font-weight:700;margin-bottom:12px;">Temel Veriler</div>
      <div class="grid-4">
        <div><span style="font-size:11px;color:var(--text-muted);">F/K</span><div class="td-mono">${s.peRatio || '-'}</div></div>
        <div><span style="font-size:11px;color:var(--text-muted);">PD/DD</span><div class="td-mono">${s.pbRatio || '-'}</div></div>
        <div><span style="font-size:11px;color:var(--text-muted);">Temett√º Verimi</span><div class="td-mono">${s.dividendYield ? s.dividendYield + '%' : '-'}</div></div>
        <div><span style="font-size:11px;color:var(--text-muted);">Beta</span><div class="td-mono">${s.beta || '-'}</div></div>
      </div>
    </div>

    <!-- Events -->
    ${events.dividends && events.dividends.length > 0 ? `
    <div class="card mb-24 fade-in">
      <div style="font-weight:700;margin-bottom:12px;">Temett√º Ge√ßmi≈üi</div>
      <div class="table-wrap"><table>
        <thead><tr><th>Tarih</th><th>Tutar</th></tr></thead>
        <tbody>${events.dividends.slice(-10).reverse().map(d =>
          `<tr><td>${d.date}</td><td class="td-mono">${fmtPrice(d.amount)} ‚Ç∫</td></tr>`
        ).join('')}</tbody>
      </table></div>
    </div>` : ''}
  `;

  // Draw chart
  drawPriceChart(s.chartData, s.code, ind);
}

function loadStockPeriod(symbol, period) {
  const container = document.getElementById('stockDetailContent');
  container.innerHTML = '<div class="loading"><div class="spinner"></div>Y√ºkleniyor...</div>';
  api('/stock/' + symbol + '?period=' + period).then(data => {
    if (!data.error) loadStockDetail(symbol);
  });
  // Simpler: just reload
  setTimeout(() => loadStockDetailWithPeriod(symbol, period), 100);
}

async function loadStockDetailWithPeriod(symbol, period) {
  const container = document.getElementById('stockDetailContent');
  container.innerHTML = '<div class="loading"><div class="spinner"></div>Y√ºkleniyor...</div>';
  // Re-fetch with different period
  const stockData = await api('/stock/' + symbol + '?period=' + period);
  if (stockData.error) {
    container.innerHTML = `<div class="empty-state"><div class="icon">‚ùå</div><div>${stockData.error}</div></div>`;
    return;
  }
  // Rebuild (reuse loadStockDetail flow by temporarily overriding)
  navigate('stock', { symbol });
}

function renderIndicator(ind, nameOverride, valueOverride) {
  if (!ind) return '';
  const name = nameOverride || ind.name || '';
  const value = valueOverride !== undefined ? valueOverride : ind.value;
  return `
    <div class="indicator-card">
      <div class="ind-name">${name}</div>
      <div class="flex-between">
        <div class="ind-value">${value != null ? (typeof value === 'number' ? value.toFixed(2) : value) : '-'}</div>
        ${signalBadge(ind.signal || ind.signalType || 'neutral')}
      </div>
      <div class="ind-explanation">${ind.explanation || ''}</div>
    </div>
  `;
}

function renderFibonacci(fib) {
  if (!fib || !fib.levels) return '<div style="color:var(--text-muted);font-size:13px;">Veri yok</div>';
  return Object.entries(fib.levels).map(([key, val]) => `
    <div class="fib-bar">
      <div class="fib-label">${key}%</div>
      <div class="fib-line"></div>
      <div class="fib-value">${fmtPrice(val)}</div>
    </div>
  `).join('');
}

function renderSR(sr) {
  if (!sr) return '<div style="color:var(--text-muted);font-size:13px;">Veri yok</div>';
  let html = '<div style="font-size:12px;color:var(--text-secondary);margin-bottom:12px;">' + (sr.explanation || '') + '</div>';

  if (sr.resistances && sr.resistances.length) {
    html += '<div style="margin-bottom:8px;font-size:11px;color:var(--text-muted);">Dƒ∞REN√á</div>';
    sr.resistances.forEach(r => {
      html += `<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
        <span style="width:8px;height:8px;background:var(--red);border-radius:50%;"></span>
        <span class="td-mono">${fmtPrice(r)}</span>
      </div>`;
    });
  }

  html += `<div style="display:flex;align-items:center;gap:8px;margin:12px 0;padding:8px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);">
    <span style="width:8px;height:8px;background:var(--accent);border-radius:50%;"></span>
    <span class="td-mono" style="color:var(--accent);font-weight:700;">G√ºncel: ${fmtPrice(sr.current)}</span>
  </div>`;

  if (sr.supports && sr.supports.length) {
    html += '<div style="margin-bottom:8px;font-size:11px;color:var(--text-muted);">DESTEK</div>';
    sr.supports.forEach(s => {
      html += `<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
        <span style="width:8px;height:8px;background:var(--green);border-radius:50%;"></span>
        <span class="td-mono">${fmtPrice(s)}</span>
      </div>`;
    });
  }
  return html;
}

// =============================================================================
// CHARTS
// =============================================================================
function drawPriceChart(chartData, symbol, indicators) {
  if (!chartData || !chartData.dates) return;
  if (currentChart) { currentChart.destroy(); currentChart = null; }

  const ctx = document.getElementById('priceChart');
  if (!ctx) return;

  const datasets = [
    {
      label: symbol + ' Kapanƒ±≈ü',
      data: chartData.prices,
      borderColor: '#00d4aa',
      backgroundColor: 'rgba(0,212,170,0.05)',
      fill: true,
      tension: 0.3,
      pointRadius: 0,
      borderWidth: 2,
    }
  ];

  // Add EMA overlays
  if (indicators?.emaHistory) {
    const ema20 = indicators.emaHistory.map(e => e.ema20 || null);
    const ema50 = indicators.emaHistory.map(e => e.ema50 || null);
    if (ema20.some(v => v)) {
      datasets.push({
        label: 'EMA 20', data: ema20,
        borderColor: '#ffc547', borderWidth: 1, pointRadius: 0, tension: 0.3, fill: false,
      });
    }
    if (ema50.some(v => v)) {
      datasets.push({
        label: 'EMA 50', data: ema50,
        borderColor: '#a78bfa', borderWidth: 1, pointRadius: 0, tension: 0.3, fill: false,
      });
    }
  }

  // Bollinger bands
  if (indicators?.bollingerHistory && indicators.bollingerHistory.length > 0) {
    const padLen = chartData.dates.length - indicators.bollingerHistory.length;
    const pad = new Array(padLen).fill(null);
    datasets.push({
      label: 'BB √úst', data: [...pad, ...indicators.bollingerHistory.map(b => b.upper)],
      borderColor: 'rgba(255,77,106,0.3)', borderWidth: 1, borderDash: [4,4], pointRadius: 0, fill: false,
    });
    datasets.push({
      label: 'BB Alt', data: [...pad, ...indicators.bollingerHistory.map(b => b.lower)],
      borderColor: 'rgba(77,166,255,0.3)', borderWidth: 1, borderDash: [4,4], pointRadius: 0, fill: false,
    });
  }

  currentChart = new Chart(ctx, {
    type: 'line',
    data: { labels: chartData.dates, datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: true, labels: { color: '#8896aa', font: { size: 11 } } },
        tooltip: {
          backgroundColor: '#1a2234', borderColor: '#2a3548', borderWidth: 1,
          titleColor: '#e8ecf4', bodyColor: '#8896aa',
          titleFont: { family: 'JetBrains Mono' }, bodyFont: { family: 'JetBrains Mono' },
        }
      },
      scales: {
        x: { grid: { color: 'rgba(42,53,72,0.3)' }, ticks: { color: '#5a6a80', maxTicksLimit: 12, font: { size: 10 } } },
        y: { grid: { color: 'rgba(42,53,72,0.3)' }, ticks: { color: '#5a6a80', font: { family: 'JetBrains Mono', size: 11 } } },
      }
    }
  });
}

// =============================================================================
// SCREENER
// =============================================================================
function addScreenerCondition() {
  const row = document.createElement('div');
  row.className = 'condition-row';
  row.innerHTML = `
    <select class="sc-indicator">
      <option value="rsi">RSI</option>
      <option value="volume_ratio">Hacim Oranƒ±</option>
      <option value="atr_pct">ATR %</option>
      <option value="ema_cross">EMA Cross</option>
      <option value="breakout">Breakout</option>
      <option value="macd_signal">MACD Sinyal</option>
      <option value="price_above_ema20">Fiyat > EMA20</option>
      <option value="price_above_ema50">Fiyat > EMA50</option>
    </select>
    <select class="sc-operator">
      <option value="<">&lt;</option>
      <option value=">">&gt;</option>
      <option value="<=">&le;</option>
      <option value=">=">&ge;</option>
      <option value="==">=</option>
    </select>
    <input class="sc-value" placeholder="Deƒüer" style="width:100px;">
    <button class="remove-condition" onclick="this.parentElement.remove()">‚úï</button>
  `;
  document.getElementById('screenerConditions').appendChild(row);
}

async function runScreener() {
  const rows = document.querySelectorAll('.condition-row');
  const conditions = [];
  rows.forEach(row => {
    const indicator = row.querySelector('.sc-indicator')?.value;
    const operator = row.querySelector('.sc-operator')?.value;
    const value = row.querySelector('.sc-value')?.value;
    if (indicator && operator && value) {
      let parsedVal = value;
      if (!isNaN(value)) parsedVal = parseFloat(value);
      else if (value === 'true') parsedVal = true;
      else if (value === 'false') parsedVal = false;
      conditions.push({ indicator, operator, value: parsedVal });
    }
  });

  const sector = document.getElementById('screenerSector').value;

  const resultsDiv = document.getElementById('screenerResults');
  resultsDiv.style.display = 'block';
  document.getElementById('screenerTable').innerHTML = '<tr><td colspan="7"><div class="loading"><div class="spinner"></div>Taranƒ±yor...</div></td></tr>';

  const data = await api('/screener', {
    method: 'POST',
    body: JSON.stringify({ conditions, sector: sector || undefined }),
  });

  if (data.error) {
    document.getElementById('screenerTable').innerHTML = `<tr><td colspan="7" style="color:var(--red);">${data.error}</td></tr>`;
    return;
  }

  document.getElementById('screenerCount').textContent = `${data.totalMatches} / ${data.scannedStocks} hisse e≈üle≈üti`;

  document.getElementById('screenerTable').innerHTML = (data.matches || []).map(m => `
    <tr class="stock-row" onclick="goToStock('${m.code}')">
      <td class="td-mono td-clickable">${m.code}</td>
      <td>${m.name}</td>
      <td class="td-mono">${fmtPrice(m.price)}</td>
      <td class="td-mono ${changeClass(m.changePct)}">${fmtPct(m.changePct)}</td>
      <td class="td-mono">${m.metrics?.rsi ?? '-'}</td>
      <td class="td-mono">${m.metrics?.volume_ratio ?? '-'}</td>
      <td>${m.metrics?.ema_cross === 'bullish' ? '<span class="badge badge-green">Bullish</span>' : '<span class="badge badge-red">Bearish</span>'}</td>
    </tr>
  `).join('') || '<tr><td colspan="7" class="empty-state">E≈üle≈üen hisse bulunamadƒ±</td></tr>';
}

// =============================================================================
// PORTFOLIO
// =============================================================================
function showAddPositionForm() {
  document.getElementById('addPositionForm').style.display = 'block';
}

async function addPosition() {
  const symbol = document.getElementById('pfSymbol').value.toUpperCase();
  const quantity = parseFloat(document.getElementById('pfQty').value);
  const avgCost = parseFloat(document.getElementById('pfCost').value);

  if (!symbol || !quantity || !avgCost) { alert('T√ºm alanlarƒ± doldurun'); return; }

  await api('/portfolio', {
    method: 'POST',
    body: JSON.stringify({ symbol, quantity, avgCost }),
  });

  document.getElementById('addPositionForm').style.display = 'none';
  document.getElementById('pfSymbol').value = '';
  document.getElementById('pfQty').value = '';
  document.getElementById('pfCost').value = '';
  loadPortfolio();
}

async function removePosition(symbol) {
  if (!confirm(`${symbol} portf√∂yden √ßƒ±karƒ±lsƒ±n mƒ±?`)) return;
  await api('/portfolio', {
    method: 'DELETE',
    body: JSON.stringify({ symbol }),
  });
  loadPortfolio();
}

async function loadPortfolio() {
  const data = await api('/portfolio');
  if (!data.success) return;

  const s = data.summary || {};

  document.getElementById('portfolioSummary').innerHTML = `
    <div class="card" style="text-align:center;">
      <div style="font-size:11px;color:var(--text-muted);">Toplam Deƒüer</div>
      <div class="td-mono" style="font-size:20px;font-weight:700;margin-top:4px;">${fmtMoney(s.totalValue)}</div>
    </div>
    <div class="card" style="text-align:center;">
      <div style="font-size:11px;color:var(--text-muted);">Toplam Maliyet</div>
      <div class="td-mono" style="font-size:20px;font-weight:700;margin-top:4px;">${fmtMoney(s.totalCost)}</div>
    </div>
    <div class="card" style="text-align:center;">
      <div style="font-size:11px;color:var(--text-muted);">Kar/Zarar</div>
      <div class="td-mono ${changeClass(s.totalPnL)}" style="font-size:20px;font-weight:700;margin-top:4px;">${fmtMoney(s.totalPnL)} (${fmtPct(s.totalPnLPct)})</div>
    </div>
    <div class="card" style="text-align:center;">
      <div style="font-size:11px;color:var(--text-muted);">G√ºnl√ºk Deƒüi≈üim</div>
      <div class="td-mono ${changeClass(s.dailyPnL)}" style="font-size:20px;font-weight:700;margin-top:4px;">${fmtMoney(s.dailyPnL)}</div>
    </div>
  `;

  const positions = data.positions || [];
  if (positions.length === 0) {
    document.getElementById('portfolioTable').innerHTML = '<tr><td colspan="9" class="empty-state">Portf√∂y bo≈ü. Pozisyon ekleyin.</td></tr>';
    document.getElementById('riskCard').style.display = 'none';
    return;
  }

  document.getElementById('portfolioTable').innerHTML = positions.map(p => `
    <tr>
      <td class="td-mono td-clickable" onclick="goToStock('${p.symbol}')">${p.symbol}</td>
      <td class="td-mono">${p.quantity}</td>
      <td class="td-mono">${fmtPrice(p.avgCost)}</td>
      <td class="td-mono">${fmtPrice(p.currentPrice)}</td>
      <td class="td-mono">${fmtMoney(p.marketValue)}</td>
      <td class="td-mono ${p.unrealizedPnL >= 0 ? 'pnl-positive' : 'pnl-negative'}">${fmtMoney(p.unrealizedPnL)}</td>
      <td class="td-mono ${p.unrealizedPnLPct >= 0 ? 'pnl-positive' : 'pnl-negative'}">${fmtPct(p.unrealizedPnLPct)}</td>
      <td class="td-mono">${p.weight}%</td>
      <td><button class="btn btn-sm" style="background:var(--red-bg);color:var(--red);border:none;padding:4px 8px;font-size:11px;" onclick="removePosition('${p.symbol}')">Sil</button></td>
    </tr>
  `).join('');

  // Load risk
  loadPortfolioRisk();
}

async function loadPortfolioRisk() {
  const data = await api('/portfolio/risk');
  if (!data.success || !data.risk) return;
  const r = data.risk;
  if (r.message) return;

  document.getElementById('riskCard').style.display = 'block';
  document.getElementById('riskMetrics').innerHTML = `
    <div class="bt-metric"><div class="bt-val">${r.volatility}%</div><div class="bt-label">Yƒ±llƒ±k Volatilite</div></div>
    <div class="bt-metric"><div class="bt-val ${changeClass(r.maxDrawdown)}">${r.maxDrawdown}%</div><div class="bt-label">Max Drawdown</div></div>
    <div class="bt-metric"><div class="bt-val">${r.sharpeRatio}</div><div class="bt-label">Sharpe Oranƒ±</div></div>
    <div class="bt-metric"><div class="bt-val ${changeClass(r.annualReturn)}">${r.annualReturn}%</div><div class="bt-label">Yƒ±llƒ±k Getiri</div></div>
  `;
}

// =============================================================================
// BACKTEST
// =============================================================================
function updateBtParams() {
  const strategy = document.getElementById('btStrategy').value;
  const row = document.getElementById('btParamsRow');
  if (strategy === 'ma_cross') {
    row.children[0].querySelector('label').textContent = 'Hƒ±zlƒ± MA';
    row.children[0].querySelector('input').value = 20;
    row.children[1].querySelector('label').textContent = 'Yava≈ü MA';
    row.children[1].querySelector('input').value = 50;
  } else if (strategy === 'breakout') {
    row.children[0].querySelector('label').textContent = 'Lookback G√ºn';
    row.children[0].querySelector('input').value = 20;
    row.children[1].querySelector('label').textContent = '(Kullanƒ±lmƒ±yor)';
    row.children[1].querySelector('input').value = 0;
  } else if (strategy === 'mean_reversion') {
    row.children[0].querySelector('label').textContent = 'RSI Alt Sƒ±nƒ±r';
    row.children[0].querySelector('input').value = 30;
    row.children[1].querySelector('label').textContent = 'RSI √úst Sƒ±nƒ±r';
    row.children[1].querySelector('input').value = 70;
  }
}

async function runBacktest() {
  const symbol = document.getElementById('btSymbol').value.toUpperCase();
  const strategy = document.getElementById('btStrategy').value;
  const period = document.getElementById('btPeriod').value;
  const p1 = parseFloat(document.getElementById('btParam1').value);
  const p2 = parseFloat(document.getElementById('btParam2').value);
  const commission = parseFloat(document.getElementById('btCommission').value) / 100;
  const capital = parseFloat(document.getElementById('btCapital').value);

  if (!symbol) { alert('Hisse kodu girin'); return; }

  let params = {};
  if (strategy === 'ma_cross') params = { fast: p1, slow: p2 };
  else if (strategy === 'breakout') params = { lookback: p1 };
  else if (strategy === 'mean_reversion') params = { rsi_low: p1, rsi_high: p2 };

  document.getElementById('btResults').style.display = 'block';
  document.getElementById('btMetrics').innerHTML = '<div class="bt-metric" style="grid-column:1/-1;"><div class="loading"><div class="spinner"></div>Backtest √ßalƒ±≈ütƒ±rƒ±lƒ±yor...</div></div>';

  const data = await api('/backtest', {
    method: 'POST',
    body: JSON.stringify({ symbol, strategy, params, period, commission, slippage: 0.001, initialCapital: capital }),
  });

  if (data.error) {
    document.getElementById('btMetrics').innerHTML = `<div style="color:var(--red);grid-column:1/-1;">${data.error}</div>`;
    return;
  }

  const r = data.results;

  document.getElementById('btMetrics').innerHTML = `
    <div class="bt-metric"><div class="bt-val ${changeClass(r.totalReturn)}">${r.totalReturn}%</div><div class="bt-label">Toplam Getiri</div></div>
    <div class="bt-metric"><div class="bt-val">${r.cagr}%</div><div class="bt-label">CAGR</div></div>
    <div class="bt-metric"><div class="bt-val">${r.sharpeRatio}</div><div class="bt-label">Sharpe</div></div>
    <div class="bt-metric"><div class="bt-val ${changeClass(r.maxDrawdown)}">${r.maxDrawdown}%</div><div class="bt-label">Max Drawdown</div></div>
    <div class="bt-metric"><div class="bt-val">${r.winRate}%</div><div class="bt-label">Kazanma Oranƒ±</div></div>
    <div class="bt-metric"><div class="bt-val">${r.totalTrades}</div><div class="bt-label">ƒ∞≈ülem Sayƒ±sƒ±</div></div>
    <div class="bt-metric"><div class="bt-val ${changeClass(r.buyAndHoldReturn)}">${r.buyAndHoldReturn}%</div><div class="bt-label">Al-Tut Getiri</div></div>
    <div class="bt-metric"><div class="bt-val ${changeClass(r.alpha)}">${r.alpha}%</div><div class="bt-label">Alpha</div></div>
  `;

  // Equity Chart
  if (btChartInstance) btChartInstance.destroy();
  const ctx = document.getElementById('btChart');
  const ec = data.equityCurve || [];

  btChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ec.map(e => e.date),
      datasets: [{
        label: 'Portf√∂y Deƒüeri',
        data: ec.map(e => e.equity),
        borderColor: '#00d4aa', backgroundColor: 'rgba(0,212,170,0.05)',
        fill: true, tension: 0.3, pointRadius: 0, borderWidth: 2,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { labels: { color: '#8896aa' } },
        tooltip: { backgroundColor: '#1a2234', borderColor: '#2a3548', borderWidth: 1, titleColor: '#e8ecf4', bodyColor: '#8896aa' }
      },
      scales: {
        x: { grid: { color: 'rgba(42,53,72,0.3)' }, ticks: { color: '#5a6a80', maxTicksLimit: 10, font: { size: 10 } } },
        y: { grid: { color: 'rgba(42,53,72,0.3)' }, ticks: { color: '#5a6a80', font: { family: 'JetBrains Mono', size: 11 } } },
      }
    }
  });

  // Trades table
  document.getElementById('btTrades').innerHTML = (data.trades || []).slice(-20).reverse().map(t => `
    <tr>
      <td>${t.date}</td>
      <td><span class="badge ${t.type.includes('BUY') ? 'badge-green' : 'badge-red'}">${t.type}</span></td>
      <td class="td-mono">${fmtPrice(t.price)}</td>
      <td class="td-mono">${t.shares || '-'}</td>
      <td class="td-mono ${t.pnl ? (t.pnl >= 0 ? 'pnl-positive' : 'pnl-negative') : ''}">${t.pnl ? fmtMoney(t.pnl) : '-'}</td>
    </tr>
  `).join('');
}

// =============================================================================
// ALERTS
// =============================================================================
async function createAlert() {
  const symbol = document.getElementById('alertSymbol').value.toUpperCase();
  const condition = document.getElementById('alertCondition').value;
  const threshold = parseFloat(document.getElementById('alertThreshold').value);
  const email = document.getElementById('alertEmail').value;
  const cooldown = parseInt(document.getElementById('alertCooldown').value);
  const confirm = parseInt(document.getElementById('alertConfirm').value);

  if (!symbol || !condition || !email) { alert('Zorunlu alanlarƒ± doldurun'); return; }

  await api('/alerts', {
    method: 'POST',
    body: JSON.stringify({ symbol, condition, threshold, email, cooldownMinutes: cooldown, confirmBars: confirm }),
  });

  document.getElementById('alertForm').style.display = 'none';
  loadAlerts();
}

async function loadAlerts() {
  const data = await api('/alerts');
  if (!data.success) return;

  const alerts = data.alerts || [];
  if (alerts.length === 0) {
    document.getElementById('alertsTable').innerHTML = '<tr><td colspan="8" class="empty-state">Hen√ºz uyarƒ± yok</td></tr>';
    return;
  }

  document.getElementById('alertsTable').innerHTML = alerts.map(a => `
    <tr>
      <td class="td-mono">${a.symbol}</td>
      <td>${a.condition}</td>
      <td class="td-mono">${a.threshold || '-'}</td>
      <td>${a.cooldownMinutes} dk</td>
      <td>${a.confirmBars} bar</td>
      <td class="td-mono">${a.triggerCount || 0}x</td>
      <td>${a.active ? '<span class="badge badge-green">Aktif</span>' : '<span class="badge badge-neutral">Pasif</span>'}</td>
      <td><button class="btn btn-sm" style="background:var(--red-bg);color:var(--red);border:none;padding:4px 8px;font-size:11px;" onclick="deleteAlert('${a.id}')">Sil</button></td>
    </tr>
  `).join('');
}

async function deleteAlert(id) {
  await api('/alerts/' + id, { method: 'DELETE' });
  loadAlerts();
}

// =============================================================================
// INIT
// =============================================================================
document.addEventListener('DOMContentLoaded', () => {
  loadDashboard();
});
</script>
</body>
</html>
